<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Shadowsocks - Plugin</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content=""><meta name="author" content=""><link rel="stylesheet" href="/assets/css/app.css"><!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]--><link rel="shortcut icon" href="/assets/img/favicon/favicon.ico"><link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicon/apple-touch-icon-114x114.png"></head><body><div id="wrap" class="boxed"><header><div class="container clearfix"><div class="four columns"><div class="logo"><a href="/en/index.html">shadowsocks</a></div></div><div class="twelve columns"><nav id="menu" class="navigation"><ul id="nav"><li><a href="javascript:void" class="">download</a><ul><li><a href="/en/download/clients.html">Clients</a></li><li><a href="/en/download/servers.html">Servers</a></li></ul></li><li><a href="javascript:void" class="">config</a><ul><li><a href="/en/config/quick-guide.html">Quick Guide</a></li><li><a href="/en/config/advanced.html">Advanced</a></li></ul></li><li><a href="javascript:void" class="active">spec</a><ul><li><a href="/en/spec/AEAD-Ciphers.html">AEAD Ciphers</a></li><li><a href="/en/spec/Implementations.html">Implementations</a></li><li><a href="/en/spec/Plugin.html">Plugin</a></li><li><a href="/en/spec/Protocol.html">Protocol</a></li><li><a href="/en/spec/Stream-Ciphers.html">Stream Ciphers</a></li></ul></li><li><a href="javascript:void" class="">about</a><ul><li><a href="/en/about/contributors.html">Contributors</a></li></ul></li><li><a href="javascript:void">en</a><ul><li><a href="/en/index.html">en</a></li></ul></li></ul></nav></div><div class="sixteen columns"><hr></div></div></header><div class="container clearfix"><div class="sixteen columns"><h1 class="page-title">Plugin<a href="https://github.com/madeye/shadowsocks-org/edit/master/docs/spec/Plugin.md" data-tooltip="Edit this page on GitHub" class="edit"><i class="icon-edit"></i></a><span class="line"></span></h1></div><div class="page-columns"><div id="markdown" class="sixteen columns bottom"><h2>SIP003: A simplified plugin design for shadowsocks</h2><h3>Architecture Overview</h3><p>The plugin of shadowsocks is very similar to the <a href="https://gitweb.torproject.org/torspec.git/tree/pt-spec.txt">Pluggable Transport</a> plugins from Tor project. Dislike the SOCKS5 proxy design in PT, every SIP003 plugin works as a tunnel (or called local port forwarding). This design aims to avoid per-connection arguments in PT, leading to much easier implementation.</p><pre><code>     <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>                    <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>
     <span class="hljs-comment">|</span>  <span class="hljs-comment">SS</span> <span class="hljs-comment">Client</span> <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span> <span class="hljs-comment">Local</span> <span class="hljs-comment">Loopback</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>  <span class="hljs-comment">Plugin</span> <span class="hljs-comment">Client</span> <span class="hljs-comment">(Tunnel)</span>   <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>
     <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>                    <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>  <span class="hljs-comment">|</span>
                                                                      <span class="hljs-comment">|</span>
                 <span class="hljs-comment">Public</span> <span class="hljs-comment">Internet</span> <span class="hljs-comment">(Obfuscated/Transformed</span> <span class="hljs-comment">traffic)</span> <span class="hljs-comment">==</span>&gt; <span class="hljs-comment">|</span>
                                                                      <span class="hljs-comment">|</span>
     <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>                    <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>  <span class="hljs-comment">|</span>
     <span class="hljs-comment">|</span>  <span class="hljs-comment">SS</span> <span class="hljs-comment">Server</span> <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span> <span class="hljs-comment">Local</span> <span class="hljs-comment">Loopback</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>  <span class="hljs-comment">Plugin</span> <span class="hljs-comment">Server</span> <span class="hljs-comment">(Tunnel)</span>   <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>
     <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>                    <span class="hljs-literal">+</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span></code></pre><h3>Life cycle of a plugin</h3><p>Very similar to PT, the plugin client/server is started as child process of shadowsocks client/server.</p><p>If any error happens, the child process of plugin should exit with a error code. Then, the parent process of shadowsocks stops as well (SIGCHLD).</p><p>When a shadowsocks client/server is stopped by user, the child process of plugin will also be terminated.</p><h3>Passing arguments to a plugin</h3><p>A plugin accepts arguments through environment variables.</p><p>a. Four <strong>MUST-HAVE</strong> environment variables are <code>SS_REMOTE_HOST</code>, <code>SS_REMOTE_PORT</code>, <code>SS_LOCAL_HOST</code> and <code>SS_LOCAL_PORT</code>. <code>SS_REMOTE_HOST</code> and <code>SS_REMOTE_PORT</code> are the hostname and port of the remote plugin service. <code>SS_LOCAL_HOST</code> and <code>SS_LOCAL_PORT</code> are the hostname and port of the local shadowsocks or plugin service.</p><p>b. One <strong>OPTIONAL</strong> environment variable is <code>SS_PLUGIN_OPTIONS</code>. If a plugin requires additional arguments, like path to a config file, these arguments can be passed as extra options in a formatted string. An example is &#39;obfs=http;obfs-host=www.baidu.com&#39;, where semicolons, equal signs and backslashes <strong>MUST</strong> be escaped with a backslash.</p><h3>Compatibility with PT</h3><p>For all the plugins from Tor projects, there are two possible ways to support them. 1) We can fork these plugins and modify them to support SIP003, e.g. <a href="https://github.com/madeye/obfs4-tunnel">obfs4-tunnel</a>. 2) Implement a adapter of PT as SIP003 plugin.</p><h3>Licenses of plugins</h3><p>As all plugin services should run in a separate process, they can pick any license they like. There is no GPL restrictions for any plugin providers.</p><h3>Restrictions</h3><p>a. Plugin over plugin is NOT supported. Only one plugin can be enabled when a shadowsocks service is started. If you really need this feature, implement a plugin-over-plugin transport as a SIP003 plugin. b. Only TCP traffic is forwarded. For now, there is no plan to support UDP traffic forwarding.</p><h3>Example projects</h3><ul><li>A SIP003 plugin for traffic obfuscating: <a href="https://github.com/shadowsocks/simple-obfs">simple-obfs</a>.</li><li>A shadowsocks implementation based on SIP003: <a href="https://github.com/shadowsocks/shadowsocks-libev">shadowsocks/shadowsocks-libev</a>.</li></ul><h3>Command line example</h3><p>On the server:</p><pre><code class="language-bash">ss-server --plugin obfs-server --plugin-opts <span class="hljs-string">"obfs=http"</span></code></pre><p>On the client:</p><pre><code class="language-bash">ss-local -c config.json --plugin obfs-local --plugin-opts <span class="hljs-string">"obfs=http;obfs-host=www.baidu.com"</span></code></pre></div></div></div><div class="push"></div></div><footer><div class="container"><div class="sisteen columns"><span class="copyright"><a href="https://github.com/shadowsocks">Projects of Shadowsocks</a>&nbsp;are distributed under different licenses, including &nbsp;<a href="https://github.com/shadowsocks/shadowsocks/blob/master/LICENSE">APL 2.0,</a>&nbsp;<a href="https://github.com/shadowsocks/shadowsocks-libev/blob/master/LICENSE">GPLv3</a>&nbsp; and &nbsp;<a href="https://github.com/shadowsocks/libQtShadowsocks/blob/master/LICENSE">LGPLv3</a>. Theme by <a href="http://karma-runner.github.io">Karma</a>.</span></div></div></footer></body><script src="/assets/js/app.js"></script><script src="/assets/js/analytics.js"></script></html>