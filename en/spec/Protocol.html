<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Shadowsocks - Protocol</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content=""><meta name="author" content=""><link rel="stylesheet" href="/assets/css/app.css"><!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]--><link rel="shortcut icon" href="/assets/img/favicon/favicon.ico"><link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicon/apple-touch-icon-114x114.png"></head><body><div id="wrap" class="boxed"><header><div class="container clearfix"><div class="four columns"><div class="logo"><a href="/en/index.html">shadowsocks</a></div></div><div class="twelve columns"><nav id="menu" class="navigation"><ul id="nav"><li><a href="javascript:void" class="">download</a><ul><li><a href="/en/download/clients.html">Clients</a></li><li><a href="/en/download/servers.html">Servers</a></li></ul></li><li><a href="javascript:void" class="">config</a><ul><li><a href="/en/config/quick-guide.html">Quick Guide</a></li><li><a href="/en/config/advanced.html">Advanced</a></li></ul></li><li><a href="javascript:void" class="active">spec</a><ul><li><a href="/en/spec/AEAD-Ciphers.html">AEAD Ciphers</a></li><li><a href="/en/spec/Implementations.html">Implementations</a></li><li><a href="/en/spec/Plugin.html">Plugin</a></li><li><a href="/en/spec/Protocol.html">Protocol</a></li><li><a href="/en/spec/Stream-Ciphers.html">Stream Ciphers</a></li></ul></li><li><a href="javascript:void" class="">about</a><ul><li><a href="/en/about/contributors.html">Contributors</a></li></ul></li><li><a href="javascript:void">en</a><ul><li><a href="/en/index.html">en</a></li></ul></li></ul></nav></div><div class="sixteen columns"><hr></div></div></header><div class="container clearfix"><div class="sixteen columns"><h1 class="page-title">Protocol<a href="https://github.com/madeye/shadowsocks-org/edit/master/docs/spec/Protocol.md" data-tooltip="Edit this page on GitHub" class="edit"><i class="icon-edit"></i></a><span class="line"></span></h1></div><div class="page-columns"><div id="markdown" class="sixteen columns bottom"><p>Shadowsocks is a secure split proxy loosely based on <a href="https://tools.ietf.org/html/rfc1928">SOCKS5</a>.</p><pre><code>client &lt;---&gt; ss-local &lt;--[encrypted]--&gt; ss-remote &lt;---&gt; target</code></pre><p>The Shadowsocks local component (ss-local) acts like a traditional SOCKS5 server and provides proxy service to clients. It encrypts and forwards data streams and packets from the client to the Shadowsocks remote component (ss-remote), which decrypts and forwards to the target. Replies from target are similarly encrypted and relayed by ss-remote back to ss-local, which decrypts and eventually returns to the original client.</p><h3>Addressing</h3><p>Addresses used in Shadowsocks follow the <a href="https://tools.ietf.org/html/rfc1928#section-5">SOCKS5 address format</a>:</p><pre><code>[<span class="hljs-string">1-byte type</span>][<span class="hljs-symbol">variable-length host</span>][<span class="hljs-string">2-byte port</span>]</code></pre><p>The following address types are defined:</p><ul><li><code>0x01</code>: host is a 4-byte IPv4 address.</li><li><code>0x03</code>: host is a variable length string, starting with a 1-byte length, followed by up to 255-byte domain name.</li><li><code>0x04</code>: host is a 16-byte IPv6 address.</li></ul><p>The port number is a 2-byte big-endian unsigned integer.</p><h3>TCP</h3><p>ss-local initiates a TCP connection to ss-remote by sending an encrypted data stream starting with the target address followed by payload data. The exact encryption scheme differs depending on the cipher used.</p><pre><code>[<span class="hljs-string">target address</span>][<span class="hljs-symbol">payload</span>]</code></pre><p>ss-remote receives the encrypted data stream, decrypts and parses the leading target address. It then establishes a new TCP connection to the target and forwards payload data to it. ss-remote receives reply from the target, encrypts and forwards it back to the ss-local, until ss-local disconnects.</p><h3>UDP</h3><p>ss-local sends an encrypted data packet containing the target address and payload to ss-remote.</p><pre><code>[<span class="hljs-string">target address</span>][<span class="hljs-symbol">payload</span>]</code></pre><p>Upon receving the encrypted packet, ss-remote decrypts and parses the target address. It then sends a new data packet containing only the payload to the target. ss-remote receives data packets back from target and prepends the target address to the payload in each packet, then sends encrypted copies back to ss-local.</p><pre><code>[<span class="hljs-string">target address</span>][<span class="hljs-symbol">payload</span>]</code></pre><p>Essentially, ss-remote is performing Network Address Translation for ss-local.</p></div></div></div><div class="push"></div></div><footer><div class="container"><div class="sisteen columns"><span class="copyright"><a href="https://github.com/shadowsocks">Projects of Shadowsocks</a>&nbsp;are distributed under different licenses, including &nbsp;<a href="https://github.com/shadowsocks/shadowsocks/blob/master/LICENSE">APL 2.0,</a>&nbsp;<a href="https://github.com/shadowsocks/shadowsocks-libev/blob/master/LICENSE">GPLv3</a>&nbsp; and &nbsp;<a href="https://github.com/shadowsocks/libQtShadowsocks/blob/master/LICENSE">LGPLv3</a>. Theme by <a href="http://karma-runner.github.io">Karma</a>.</span></div></div></footer></body><script src="/assets/js/app.js"></script><script src="/assets/js/analytics.js"></script></html>