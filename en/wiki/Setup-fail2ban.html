<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Shadowsocks - Setup Fail2ban</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content=""><meta name="author" content=""><link rel="stylesheet" href="/assets/css/app.css"><link rel="shortcut icon" href="/assets/img/favicon/favicon.ico"><link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicon/apple-touch-icon-114x114.png"></head><body><div class="boxed" id="wrap"><header><div class="container clearfix"><div class="four columns"><div class="logo"><a href="/#{self.version}/index.html">shadowsocks</a></div></div><div class="twelve columns"><nav class="navigation" id="menu"><ul id="nav"><li><a class="#{active}" href="javascript:void">download</a><ul><li><a href="/en/download/clients.html">Clients</a></li><li><a href="/en/download/servers.html">Servers</a></li></ul></li><li><a class="#{active}" href="javascript:void">config</a><ul><li><a href="/en/config/quick-guide.html">Quick Guide</a></li><li><a href="/en/config/advanced.html">Advanced</a></li></ul></li><li><a class="#{active}" href="javascript:void">wiki</a><ul><li><a href="/en/wiki/AEAD-Ciphers.html">AEAD Ciphers</a></li><li><a href="/en/wiki/Implementations.html">Implementations</a></li><li><a href="/en/wiki/Plugin.html">Plugin</a></li><li><a href="/en/wiki/Protocol.html">Protocol</a></li><li><a href="/en/wiki/SIP002-URI-Scheme.html">SIP002 URI Scheme</a></li><li><a href="/en/wiki/SIP008-Online-Configuration-Delivery.html">SIP008 Online Configuration Delivery</a></li><li><a href="/en/wiki/Setup-fail2ban.html">Setup Fail2ban</a></li><li><a href="/en/wiki/Stream-Ciphers.html">Stream Ciphers</a></li></ul></li><li><a class="#{active}" href="javascript:void">about</a><ul><li><a href="/en/about/contributors.html">Contributors</a></li></ul></li><li><a href="javascript:void">en</a><ul><li><a href="/en/index.html">en</a></li></ul></li></ul></nav></div><div class="sixteen columns"><hr></div></div></header><div class="container clearfix"><div class="sixteen columns"><h1 class="page-title">Setup Fail2ban<a class="edit" href="#{self.editUrl}" data-tooltip="Edit this page on GitHub"><i class="icon-edit"></i></a><span class="line"></span></h1></div><div class="page-columns"><div class="sixteen columns bottom" id="markdown"><p>Setup fail2ban for shadowsocks-libev</p><p>Source: <a href="http://blog.zedyeung.com/2018/08/14/Ubuntu-18-04-set-up-Shadowsocks-server-with-fail2ban/">http://blog.zedyeung.com/2018/08/14/Ubuntu-18-04-set-up-Shadowsocks-server-with-fail2ban/</a></p><p>An example log:</p><pre><code>Aug <span class="hljs-number">15</span> <span class="hljs-number">08</span>:<span class="hljs-number">59</span>:<span class="hljs-number">07</span> &lt;hostname&gt; ss-server[<span class="hljs-number">1382</span>]: <span class="hljs-number">2018</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">08</span>:<span class="hljs-number">59</span>:<span class="hljs-number">07</span> ERROR: failed to handshake with &lt;HOST&gt;: authentication error</code></pre><p>Create a filter:</p><pre><code class="language-bash">sudo tee /etc/fail2ban/filter.d/shadowsocks-libev.conf &gt; /dev/null &lt;&lt;<span class="hljs-string">EOF
[INCLUDES]
before = common.conf

[Definition]
_daemon = ss-server

failregex = ^\w+\s+\d+ \d+:\d+:\d+\s+%(__prefix_line)sERROR:\s+failed to handshake with &lt;HOST&gt;: authentication error$

ignoreregex =

datepattern = %%Y-%%m-%%d %%H:%%M:%%S
EOF</span></code></pre><p>Update jail config</p><p><code>sudo vim /etc/fail2ban/jail.local</code></p><pre><code class="language-bash">[shadowsocks-libev]
enabled = <span class="hljs-literal">true</span>
filter = shadowsocks-libev
port = 8839
logpath = /var/<span class="hljs-built_in">log</span>/syslog

maxretry = 3
findtime = 3600
bantime = 3600</code></pre><p>Start fail2ban</p><pre><code class="language-bash">sudo systemctl restart fail2ban
sudo systemctl <span class="hljs-built_in">enable</span> fail2ban
sudo systemctl start fail2ban
sudo systemctl status fail2ban
sudo fail2ban-client status shadowsocks
sudo fail2ban-client status shadowsocks-libev</code></pre></div></div></div><div class="push"></div></div><footer><div class="container"><div class="sisteen columns"><span class="copyright"><a href="https://github.com/shadowsocks">Projects of Shadowsocks</a>&nbsp;are distributed under different licenses, including &nbsp;<a href="https://github.com/shadowsocks/shadowsocks/blob/master/LICENSE">APL 2.0,</a>&nbsp;<a href="https://github.com/shadowsocks/shadowsocks-libev/blob/master/LICENSE">GPLv3</a>&nbsp; and &nbsp;<a href="https://github.com/shadowsocks/libQtShadowsocks/blob/master/LICENSE">LGPLv3</a>. Theme by <a href="http://karma-runner.github.io">Karma</a>.</span></div></div></footer></body><script src="/assets/js/app.js"></script><script src="/assets/js/analytics.js"></script></html>